# Банковская система - Управление валютными операциями

Настольное приложение с графическим интерфейсом для банковского сотрудника, управляющего валютными операциями, курсами валют и счетами клиентов.

## Предметная область

Система предназначена для работы сотрудника банка с валютными операциями:
- Управление справочником валют
- Актуализация курсов валют
- Регистрация клиентов
- Открытие валютных счетов
- Проведение операций покупки/продажи валюты
- Просмотр истории транзакций

## Стек технологий

- **Python**: 3.12+
- **GUI**: PySide6 (Qt for Python)
- **База данных**: PostgreSQL 13+
- **Драйвер БД**: psycopg2-binary
- **ОС**: Windows, Linux, macOS (кроссплатформенность)

## Функциональность

### Демонстрируемые возможности PostgreSQL

1. **Типы данных**:
   - TEXT, VARCHAR - текстовые поля (ФИО, описания)
   - INTEGER, NUMERIC - числовые значения (суммы, курсы)
   - BOOLEAN - логические флаги (VIP, активность)
   - TIMESTAMP, DATE - временные метки и даты
   - ENUM - пользовательские типы (transaction_type, account_status)
   - ARRAY - массивы (разрешенные операции для клиента)

2. **SQL операторы**:
   - CREATE SCHEMA - создание схемы bank_system
   - CREATE TYPE - создание ENUM типов
   - CREATE TABLE - создание таблиц с ограничениями
   - INSERT - вставка данных (включая тестовые данные при создании)
   - SELECT - выборка с JOIN запросами

3. **Ограничения**:
   - NOT NULL - обязательные поля
   - UNIQUE - уникальность (код валюты, паспорт, номер счета)
   - CHECK - проверка диапазонов (курсы > 0, баланс >= 0, дата рождения < сегодня)

4. **Ключи**:
   - PRIMARY KEY - первичные ключи (SERIAL)
   - FOREIGN KEY - внешние ключи с ON DELETE CASCADE/RESTRICT
   - ON UPDATE CASCADE - каскадное обновление

5. **Механизмы ссылочной целостности**:
   - Демонстрация попыток нарушения связей
   - Каскадное удаление зависимых записей (счета → транзакции)
   - Предотвращение удаления при наличии ссылок (валюта → курсы)

### Возможности приложения

1. **Подключение к БД** - диалог с параметрами подключения
2. **Создание схемы** - автоматическое развертывание БД с тестовыми данными
3. **Добавление данных** - модальные формы для каждой таблицы:
   - Валюты
   - Курсы валют
   - Клиенты
   - Валютные счета
   - Транзакции
4. **Просмотр данных** - табличное представление с фильтрами:
   - Фильтр по базовой валюте (для курсов)
   - Фильтр по валюте счета
   - Фильтр по типу транзакции
   - Фильтр по дате
   - JOIN-запросы для связанных данных
5. **Обработка ошибок** - понятные сообщения об ошибках БД:
   - Нарушение UNIQUE
   - Нарушение NOT NULL
   - Нарушение CHECK
   - Нарушение FOREIGN KEY
   - Ошибки типов данных
   - Ошибки подключения
6. **Логирование** - запись всех операций в файл с временными метками

## Установка и запуск

### Предварительные требования

1. **Python 3.12 или выше**
   ```bash
   python --version
   ```

2. **PostgreSQL 13 или выше**
   ```bash
   brew services start postgresql
   ```

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Настройка базы данных

1. Создайте базу данных (опционально):
   ```bash
   createdb bank_db
   ```

### Запуск приложения

```bash
python main.py
```

### Первый запуск

1. При запуске появится окно подключения к БД
2. Введите параметры:
   - **Хост**: localhost
   - **Порт**: 5433
   - **База данных**: postgres (или bank_db)
   - **Пользователь**: ваш username (узнать: `whoami`)
   - **Пароль**: оставьте пустым для локальной установки
3. Нажмите "Подключиться"
4. После успешного подключения нажмите **"Создать схему и таблицы"**
5. Схема будет создана с тестовыми данными!

## Структура базы данных

### Таблицы

1. **currencies** - справочник валют (8 валют в тестовых данных)
2. **exchange_rates** - курсы валют (8 пар валют с актуальными курсами)
3. **clients** - клиенты банка (6 клиентов)
4. **currency_accounts** - валютные счета (15 счетов в разных валютах)
5. **transactions** - транзакции (20 операций покупки/продажи)

### Связи

- exchange_rates → currencies (FOREIGN KEY, ON DELETE RESTRICT)
- clients: уникальный паспорт, массив разрешенных операций
- currency_accounts → clients (FOREIGN KEY, ON DELETE CASCADE)
- currency_accounts → currencies (FOREIGN KEY, ON DELETE RESTRICT)
- transactions → currency_accounts (FOREIGN KEY, ON DELETE CASCADE)
- transactions → currencies (FOREIGN KEY, ON DELETE RESTRICT)

### ENUM типы

- **transaction_type**: BUY, SELL, TRANSFER, DEPOSIT, WITHDRAWAL
- **account_status**: ACTIVE, BLOCKED, CLOSED

## Тестовые данные

После создания схемы в базе автоматически появятся:

### Валюты (8 шт)
- RUB (Российский рубль)
- USD (Доллар США)
- EUR (Евро)
- GBP (Фунт стерлингов)
- CNY (Китайский юань)
- JPY (Японская йена)
- CHF (Швейцарский франк)
- TRY (Турецкая лира - неактивна)

### Клиенты (6 человек)
- Смирнов Алексей Петрович (VIP)
- Кузнецова Мария Ивановна
- Попов Дмитрий Сергеевич (VIP)
- Васильева Елена Николаевна
- Петров Игорь Владимирович
- Новикова Ольга Александровна (VIP)

### Валютные счета (15 шт)
Счета в различных валютах с балансами от 800 до 520,000 единиц

### Транзакции (20 операций)
Операции покупки/продажи валюты за сентябрь-октябрь 2024

## Примеры использования

### Просмотр всех клиентов

1. Нажмите **"Показать данные"**
2. Перейдите на вкладку **"Клиенты"**
3. Нажмите **"Загрузить данные"**
4. Увидите список из 6 клиентов с их данными

### Просмотр транзакций по типу

1. Откройте **"Показать данные"** → **"Транзакции"**
2. Выберите тип операции (например, BUY)
3. Нажмите **"Применить фильтр"**
4. Увидите только операции покупки валюты

### Добавление нового курса

1. Откройте **"Внести данные"** → **"Курсы валют"**
2. Заполните:
   - Базовая валюта: EUR
   - Целевая валюта: USD
   - Курс покупки: 1.08
   - Курс продажи: 1.10
   - Обновил: Ваше ФИО
3. Нажмите **"Добавить курс"**

### Демонстрация ссылочной целостности

**ON DELETE RESTRICT:**
- Попробуйте удалить валюту USD (используется в курсах и счетах)
- Система не позволит удалить и выдаст ошибку

**ON DELETE CASCADE:**
- При удалении клиента автоматически удалятся его счета
- При удалении счета автоматически удалятся его транзакции

### Демонстрация ограничений

**UNIQUE:**
- Попробуйте добавить клиента с паспортом "4512 678901" (уже существует)
- Получите ошибку уникальности

**CHECK:**
- Попробуйте добавить курс с отрицательным значением
- Получите ошибку CHECK constraint

**NOT NULL:**
- Попробуйте добавить клиента без ФИО
- Получите ошибку обязательного поля

## Логирование

Все действия записываются в файл `mlops_ddos_app.log`:
- Подключения к БД
- Выполненные DDL/DML операции
- Ошибки и исключения
- Время выполнения операций

## Обработка ошибок

Приложение перехватывает все ошибки PostgreSQL и отображает понятные сообщения:

- **UNIQUE violation**: "Запись с таким значением уже существует"
- **NOT NULL violation**: "Поле 'имя_поля' обязательно для заполнения"
- **CHECK violation**: "Значение не соответствует ограничению"
- **FOREIGN KEY violation**: "Ссылка на несуществующую запись" или "Невозможно удалить"
- **Type mismatch**: "Неверный тип данных"

## Структура проекта

```
project1/
├── main.py                  # Главное окно приложения
├── gui_windows.py           # Диалоговые окна
├── db_manager.py            # Менеджер работы с БД
├── logger_config.py         # Настройка логирования
├── database_schema.sql      # SQL скрипт создания схемы + тестовые данные
├── requirements.txt         # Зависимости Python
├── README.md                # Документация
└── bank_app.log             # Лог-файл
```

## Технические детали

- **Parameterized queries**: Все INSERT операции используют параметризованные запросы
- **Транзакции**: Автоматический ROLLBACK при ошибках
- **Индексы**: Созданы для оптимизации запросов по валютам, датам, типам
- **Модальные окна**: Родительское окно блокируется во время работы с диалогами
- **JOIN запросы**: Автоматическое объединение данных (клиент + счет + транзакция)
- **Кроссплатформенность**: Qt/PySide6 обеспечивает единый вид на всех ОС

## Автор

Петушкова Дарья Денисовна

## Лицензия

Учебный проект, свободное использование.
